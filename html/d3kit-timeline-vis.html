<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>d3Kit-timeline</title>

  <link rel="stylesheet" href="d3kit-timeline-style.css">
  <style>
    .axis path{
      fill: none;
      stroke-width: 2px;
      stroke: #222;
    }

    .axis line{
      fill: none;
      stroke-width: 1px;
      stroke: #222;
    }

    .axis text{
      font-size: 10px;
    }

    path.link{
      stroke-width: 2px;
      opacity: 0.6;
    }

    text.label-text{
      font-size: 12px;
    }
  </style>
</head>


<body>

<br>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://rawgit.com/twitter/d3kit/master/dist/d3kit.min.js"></script>
<script src="https://rawgit.com/twitter/labella.js/master/dist/labella.min.js"></script>
<script src="https://rawgit.com/kristw/d3kit-timeline/master/dist/d3kit-timeline.min.js"></script>

<div class="timeline" id="t1x"></div>
<script>
/* globals d3, d3Kit, d3KitTimeline */

'use strict';

var display_date = '2011-3';

var display_year = display_date.split('-')[0],
    display_month = display_date.split('-')[1];

// set the date domain, since the display_month to the next month
var min = new Date(display_year, display_month-1, '1'), // month parameter is zero based
    max = new Date(display_year, display_month, '1');

d3.json("../testdata/posts_10206020424375054.json", function(err, json) {
  var time_format = d3.time.format("%Y-%m-%dT%X%Z");

  var data = [];
  var element = document.getElementById('chart');

  json.data.forEach(function(d) {
    var date = time_format.parse(d.created_time);
    var date_object = {
      time: date,
      id: d.id,
      message: d.message,
      story: d.story
    };

    data.push(date_object);
  });

  var nested_data = d3.nest()
    .key(function(d) { return (d.time.getFullYear())+'-'+(d.time.getMonth()+1); })
    .entries(data);

  console.log(nested_data)

  nested_data = nested_data.filter(function(d){ return d.key === display_date; });

  var chart1x = new d3KitTimeline('#t1x', {
      direction: 'right',
      initialWidth: 500,
      initialHeight: 1500,
      dotColor: '#ffaeb9',
      labelBgColor: '#ffaeb9',
      linkColor: '#ffaeb9',
      labelTextColor: '#000000',
      domain: [max, min], // reverse the order to newest post first
      textFn: function(d){
        return d.time.getFullYear() + '/' + (d.time.getMonth()+1) + '/' + d.time.getDate() + ' - ' + (d.message || d.story);
      }
    }).data(nested_data[0].values);
});
</script>

<div class="timeline" id="t2x"></div>
<script>
/* globals d3, d3Kit, d3KitTimeline */

'use strict';

// other data
d3.json("../testdata/posts_974071749342682.json", function(err, json) {
  var time_format = d3.time.format("%Y-%m-%dT%X%Z");

  var data = [];
  var element = document.getElementById('chart');

  json.data.forEach(function(d) {
    var date = time_format.parse(d.created_time);
    var date_object = {
      time: date,
      id: d.id,
      message: d.message,
      story: d.story
    };

    data.push(date_object);
  });

  var nested_data = d3.nest()
    .key(function(d) { return (d.time.getFullYear())+'-'+(d.time.getMonth()+1); })
    .entries(data);

  console.log(nested_data)

  nested_data = nested_data.filter(function(d){ return d.key === display_date; });

  var chart2x = new d3KitTimeline('#t2x', {
      direction: 'left',
      initialWidth: 500,
      initialHeight: 1500,
      dotColor: '#133754',
      labelBgColor: '#133754',
      linkColor: '#133754',
      labelTextColor: '#ffffff',
      domain: [max, min], // reverse the order to newest post first
      textFn: function(d){
        return d.time.getFullYear() + '/' + (d.time.getMonth()+1) + '/' + d.time.getDate() + ' - ' + (d.message || d.story);
      }
    }).data(nested_data[0].values);
});
</script>

</body>
</html>
